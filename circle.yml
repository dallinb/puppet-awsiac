---
compile:
  override:
    - "bundle exec rake build"
dependencies:
  override:
    - "wget https://apt.puppetlabs.com/puppetlabs-release-pc1-trusty.deb"
    - "sudo dpkg -i puppetlabs-release-pc1-trusty.deb"
    - "sudo apt-get update"
    - "sudo apt-get install puppetserver"
    - "/opt/puppetlabs/bin/puppet --version"
    - "sudo /opt/puppetlabs/puppet/bin/gem install aws-sdk-core retries"
    - "sudo puppet module install --verbose puppetlabs-aws"
    - "sudo puppet module install --verbose --test puppetlabs-stdlib"
    - "bundle install"
deployment:
  init:
    branch: /.*-init/
    commands:
      - "puppet module install --verbose --target-dir=/home/ubuntu/modules pkg/locp-awsiac-0.1.0.tar.gz"
      - "FACTER_ENSURE=present puppet apply --modulepath=/home/ubuntu/modules --debug --test examples/init.pp"
machine:
  environment:
    AWS_REGION: eu-west-2
test:
  override:
    - "bundle exec rake release_checks"
